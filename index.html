<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodCo Ultimate Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .active-nav { background: #4f46e5; color: white; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4); }
        input, select { border: 1px solid #e2e8f0; border-radius: 10px; padding: 10px; transition: 0.2s; }
        input:focus { border-color: #4f46e5; outline: none; ring: 2px #4f46e5; }
        .tab-content { display: none; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-900">

    <div class="flex h-screen">
        <aside class="w-72 bg-slate-900 text-white p-6 flex flex-col shadow-2xl">
            <h1 class="text-2xl font-black mb-10 text-indigo-400">FOODCO <span class="text-white text-sm">PRO v4</span></h1>
            
            <nav class="flex-1 space-y-2">
                <button onclick="switchTab('home')" id="btn-home" class="w-full flex items-center gap-3 p-4 rounded-xl active-nav"><i class="fas fa-home"></i> Dashboard</button>
                <button onclick="switchTab('members')" id="btn-members" class="w-full flex items-center gap-3 p-4 rounded-xl hover:bg-slate-800"><i class="fas fa-user-plus"></i> Members</button>
                <button onclick="switchTab('finance')" id="btn-finance" class="w-full flex items-center gap-3 p-4 rounded-xl hover:bg-slate-800"><i class="fas fa-wallet"></i> Finance</button>
                <button onclick="switchTab('menu')" id="btn-menu" class="w-full flex items-center gap-3 p-4 rounded-xl hover:bg-slate-800"><i class="fas fa-utensils"></i> Menu Card</button>
            </nav>

            <button onclick="alert('Google Auth Ready: Link your Firebase Config in script')" class="mt-auto bg-white/10 p-3 rounded-xl flex items-center justify-center gap-2 hover:bg-red-500 transition font-bold">
                <i class="fab fa-google"></i> SIGN IN
            </button>
        </aside>

        <main class="flex-1 overflow-y-auto p-10">

            <section id="tab-home" class="tab-content block space-y-8">
                <div class="flex justify-between items-end">
                    <div>
                        <h2 class="text-4xl font-black">Company Pulse</h2>
                        <p class="text-slate-500 mt-2">Real-time financial & eating statistics</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                        <p class="text-xs font-bold text-slate-400 uppercase">Total Collection</p>
                        <p id="h-total-in" class="text-3xl font-black text-green-600">₹ 0</p>
                    </div>
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                        <p class="text-xs font-bold text-slate-400 uppercase">Total Expenses</p>
                        <p id="h-total-out" class="text-3xl font-black text-red-500">₹ 0</p>
                    </div>
                    <div class="bg-indigo-600 p-8 rounded-[2.5rem] shadow-xl text-white">
                        <p class="text-xs font-bold opacity-80 uppercase">Pending Balance</p>
                        <p id="h-pending" class="text-3xl font-black">₹ 0</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-[2rem] shadow-sm">
                    <canvas id="balanceChart" height="100"></canvas>
                </div>
            </section>

            <section id="tab-members" class="tab-content space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-black">Member Directory</h2>
                    <div class="flex gap-2">
                        <input type="text" id="m-name" placeholder="Full Name" class="w-64">
                        <select id="m-dept">
                            <option>AIDS</option><option>AIML</option><option>CSE</option><option>IT</option>
                            <option>ECE</option><option>EEE</option><option>CIVIL</option><option>MECH</option>
                        </select>
                        <button onclick="addMember()" class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold">+ Register</button>
                    </div>
                </div>

                <div class="bg-white rounded-[2rem] shadow overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 border-b">
                            <tr>
                                <th class="p-5">Name (ID)</th>
                                <th class="p-5">Dept</th>
                                <th class="p-5">Year</th>
                                <th class="p-5">Phone</th>
                                <th class="p-5">Status</th>
                            </tr>
                        </thead>
                        <tbody id="member-list"></tbody>
                    </table>
                </div>
            </section>

            <section id="tab-finance" class="tab-content space-y-6">
                <h2 class="text-3xl font-black">Finance & Spending</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-[2rem] shadow-lg border-t-4 border-indigo-500">
                        <h3 class="font-bold text-lg mb-4">Record Payment (Student)</h3>
                        <div class="space-y-4">
                            <select id="f-student" class="w-full"></select>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="number" id="f-sal" placeholder="Salary Declared">
                                <input type="number" id="f-mat" placeholder="Material Declared">
                            </div>
                            <input type="number" id="f-paid" placeholder="Amount Paid Today" class="w-full">
                            <button onclick="saveFinance()" class="w-full bg-slate-900 text-white font-bold p-4 rounded-xl">Secure Entry</button>
                        </div>
                    </div>
                    <div class="bg-white p-8 rounded-[2.5rem] shadow-sm overflow-hidden">
                        <h3 class="font-bold mb-4">Individual Balances</h3>
                        <div id="balance-list" class="space-y-3"></div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        let db;
        // OPEN DATABASE
        const req = indexedDB.open("FoodCoFinal", 1);
        req.onupgradeneeded = (e) => {
            db = e.target.result;
            db.createObjectStore("members", { keyPath: "name" });
            db.createObjectStore("logs", { keyPath: "id", autoIncrement: true });
        };
        req.onsuccess = (e) => { db = e.target.result; renderAll(); };

        // TAB SWITCHER
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-nav'));
            document.getElementById('tab-' + tabId).style.display = 'block';
            document.getElementById('btn-' + tabId).classList.add('active-nav');
            renderAll();
        }

        // --- MEMBER LOGIC ---
        function addMember() {
            const name = document.getElementById('m-name').value;
            if(!name) return alert("Enter Name");
            const data = {
                name: name,
                dept: document.getElementById('m-dept').value,
                year: "1st Year",
                phone: "0000000000",
                sal: 0, mat: 0, paid: 0
            };
            const tx = db.transaction("members", "readwrite");
            tx.objectStore("members").add(data);
            tx.oncomplete = () => { document.getElementById('m-name').value = ""; renderAll(); };
        }

        function updateField(name, field, val) {
            const tx = db.transaction("members", "readwrite");
            const store = tx.objectStore("members");
            store.get(name).onsuccess = (e) => {
                const data = e.target.result;
                data[field] = val;
                store.put(data);
            };
        }

        // --- FINANCE LOGIC ---
        function saveFinance() {
            const name = document.getElementById('f-student').value;
            const sal = Number(document.getElementById('f-sal').value) || 0;
            const mat = Number(document.getElementById('f-mat').value) || 0;
            const paid = Number(document.getElementById('f-paid').value) || 0;

            const tx = db.transaction("members", "readwrite");
            const store = tx.objectStore("members");
            store.get(name).onsuccess = (e) => {
                const data = e.target.result;
                data.sal += sal;
                data.mat += mat;
                data.paid += paid;
                store.put(data);
                
                // Clear inputs
                document.getElementById('f-sal').value = "";
                document.getElementById('f-mat').value = "";
                document.getElementById('f-paid').value = "";
                renderAll();
                alert("Entry Stored Successfully!");
            };
        }

        // --- RENDER ENGINE (The Heart of the app) ---
        function renderAll() {
            const memberList = document.getElementById('member-list');
            const financeSelect = document.getElementById('f-student');
            const balanceList = document.getElementById('balance-list');
            
            if(!memberList) return; // Guard if not in DOM

            memberList.innerHTML = "";
            financeSelect.innerHTML = "";
            balanceList.innerHTML = "";

            let totalCollection = 0;
            let totalPending = 0;

            const tx = db.transaction("members", "readonly");
            tx.objectStore("members").openCursor().onsuccess = (e) => {
                const cursor = e.target.result;
                if(cursor) {
                    const m = cursor.value;
                    const balance = (m.sal + m.mat) - m.paid;
                    totalCollection += m.paid;
                    totalPending += balance;

                    // Table Row
                    memberList.innerHTML += `
                        <tr class="border-b hover:bg-slate-50 transition">
                            <td class="p-5 font-bold text-slate-400">${m.name}</td>
                            <td class="p-5"><input onchange="updateField('${m.name}', 'dept', this.value)" value="${m.dept}" class="p-1 w-24"></td>
                            <td class="p-5"><input onchange="updateField('${m.name}', 'year', this.value)" value="${m.year}" class="p-1 w-24"></td>
                            <td class="p-5"><input onchange="updateField('${m.name}', 'phone', this.value)" value="${m.phone}" class="p-1 w-32"></td>
                            <td class="p-5"><span class="text-green-500 font-bold">● Active</span></td>
                        </tr>
                    `;

                    // Finance Select
                    financeSelect.innerHTML += `<option value="${m.name}">${m.name}</option>`;

                    // Balance Card
                    balanceList.innerHTML += `
                        <div class="flex justify-between items-center p-4 bg-slate-50 rounded-2xl border border-slate-200">
                            <div>
                                <p class="font-bold text-slate-800">${m.name}</p>
                                <p class="text-[10px] text-slate-400 uppercase">Paid: ₹${m.paid}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-indigo-600 font-black">₹${balance}</p>
                                <p class="text-[10px] text-slate-400 uppercase">Balance</p>
                            </div>
                        </div>
                    `;

                    cursor.continue();
                } else {
                    // Update Dashboard
                    document.getElementById('h-total-in').innerText = "₹ " + totalCollection.toLocaleString();
                    document.getElementById('h-pending').innerText = "₹ " + totalPending.toLocaleString();
                }
            };
        }
    </script>
</body>
</html>
